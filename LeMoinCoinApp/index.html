<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>First App</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>
</head>

<body>
<div class="container">

    <h1>Reiner Coin</h1>

    <h2>Infos</h2>
    <div id="thisAdd">This address: </div>
    <div id="myBalance">My balance: </div>
    <div id="totSupply">Total supply: </div>

    <h2 >Get balance of account</h2>

    <div id="balanceOfText"></div>
    <input id="balanceOfAdd" type="text">
    <button id="balanceOfButton">Show balance</button>

    <h2>Send coins</h2>

    <img id="loader" src="https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif">

    <div>Transfer to:</div>
    <input id="transferAdd" type="text">
    <div>Amount:</div>
    <input id="transferAmount" type="text">
    <button id="transferButton">Transfer coins</button>



</div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

<script>
    if (typeof web3 !== 'undefined') {
        // Case: Web3 was already defined.
        web3 = new Web3(web3.currentProvider);
    } else {
        // Case: Web3 was not defined yet, thus local dist is chosen.
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"))
    }
    // Chose first of the given 10 start accounts as default account.
    web3.eth.defaultAccount = web3.eth.accounts[0];
    // Set the application binary interface (ABI) for this smart contract.
    var ReinerCoinContract = web3.eth.contract([
        {
            "constant": true,
            "inputs": [],
            "name": "totalSupply",
            "outputs": [
                {
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "this_add",
            "outputs": [
                {
                    "name": "",
                    "type": "address"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "test_output",
            "outputs": [
                {
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "pure",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "show_me_my_balance",
            "outputs": [
                {
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [
                {
                    "name": "tokenOwner",
                    "type": "address"
                }
            ],
            "name": "balanceOf",
            "outputs": [
                {
                    "name": "balance",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "name": "balance",
                    "type": "uint256"
                }
            ],
            "name": "new_balance",
            "type": "event"
        },
        {
            "constant": false,
            "inputs": [
                {
                    "name": "receiver",
                    "type": "address"
                },
                {
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "transfer",
            "outputs": [
                {
                    "name": "",
                    "type": "bool"
                }
            ],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "constructor"
        }
    ]);

    // Define the address of the contract.
    var ReinerCoin = ReinerCoinContract.at('0xf427c886fabfd2541fd2a1a93a652c7629c8d241');

    // Create event listener for transfer events.
    var transferEvent = ReinerCoin.new_balance();
    transferEvent.watch(function(error, result){
        if(!error){
            // Hide the loading animation when finished.
            $("#loader").hide();
            $("#myBalance").html('My balance: ' + result.args.balance);
        } else {
            // Hide the loading animation when finished.
            $("#loader").hide();
            console.log(error);
        }
    });


    ReinerCoin.this_add(function(error, result) {
        if (!error) {
            $("#thisAdd").html('This address: ' + result.toString());
        } else {
            console.log(error);
        }
    });

    ReinerCoin.show_me_my_balance(function(error, result) {
        if (!error) {
            $("#myBalance").html('My balance: ' + result.toString());
        } else {
            console.log(error);
        }
    });

    ReinerCoin.totalSupply(function(error, result) {
        if (!error) {
            $("#totSupply").html('Total supply: ' + result.toString());
        } else {
            console.log(error);
        }
    });

    $("#balanceOfButton").click(function() {
        console.log($("#balanceOfAdd").val());
        ReinerCoin.balanceOf($("#balanceOfAdd").val(), function(error, result){
            $("#balanceOfText").html('Balance: ' + result.toString());
        });
    });

    $("#transferButton").click(function() {
        $("#loader").show();

        ReinerCoin.transfer($("#transferAdd").val(), $("#transferAmount").val(), function (error, result) {
            if (error) {
                console.log('ja schon');
                $("#loader").hide();
                console.log(error);
            }
        });

    });


</script>

</body>


</html>